#pragma once

#include <string>
using namespace std;

#include "TipsBoxDef.h"

/******************************************************************************
提示框操作类
功能：
	操作提示框
作者：
	佳也 2623168833 jaye8090@qq.com
时间：
	2013-10-20 到 2013-10-21
******************************************************************************/
class CTipsBox
{
public:
	CTipsBox(void);

	~CTipsBox(void);

	/**************************************************************************
	初始化
	参数：
		peditTips		提示框指针
		pParentWnd		父窗口指针
	**************************************************************************/
	void Init(CEdit * peditTips, CWnd * pParentWnd);

//基本接口
public:
	/**************************************************************************
	输出提示
	说明：
		此接口是线程安全的
	参数：
		strTip		提示
	**************************************************************************/
	void PutTip(CString strTip);

	/**************************************************************************
	处理点击事件
	说明：
		此接口是线程安全的
	参数：
		pt		点击坐标
	**************************************************************************/
	void OnClick(const CPoint & pt);

	/**************************************************************************
	保存提示信息
	说明：
		此接口是线程安全的
		转存为文件，并清空提示框。
	**************************************************************************/
	void SaveTips(void);

//内部操作
private:
	/**************************************************************************
	输出提示
	**************************************************************************/
	void _PutTip(CString strTip);

	/**************************************************************************
	是否需要保存
	返回：
		需要保存返回true，否则返回false。
	**************************************************************************/
	bool _IsNeedSave(void);

	/**************************************************************************
	保存提示信息
	**************************************************************************/
	void _SaveTips(void);

	/**************************************************************************
	创建提示日志目录
	**************************************************************************/
	void _CreateTipsLogPath(void);

	/**************************************************************************
	保存到文件
	参数：
		strFileName		文件名
		strText			要保存的文本
	**************************************************************************/
	void _SaveToFile(CString strFileName, const CString & strText);

	/**************************************************************************
	获取软件目录
	返回：
		软件目录
	**************************************************************************/
	CString _GetSoftwarePath(void);

	/**************************************************************************
	错误处理
	参数：
		iErrCode		错误码
		strErr			错误串
	**************************************************************************/
	void _OnErr(int iErrCode, string strErr);

	/**************************************************************************
	接口互斥加锁
	**************************************************************************/
	void _LockInterface(void);

	/**************************************************************************
	接口互斥解锁
	**************************************************************************/
	void _UnlockInterface(void);

	/**************************************************************************
	变量互斥加锁
	**************************************************************************/
	void _LockScroll(void);

	/**************************************************************************
	变量互斥解锁
	**************************************************************************/
	void _UnlockScroll(void);

//内部数据
private:
	CCriticalSection		m_csInterface;		//接口互斥
	CCriticalSection		m_csScroll;			//变量互斥

	CEdit		* m_peditTips;			//提示框指针
	CWnd		* m_pParentWnd;			//父窗口指针
	CString		m_strSoftwarePath;		//软件目录

	CRect		m_rcTips;		//提示框区域
	bool		m_bScroll;		//是否滚动
};