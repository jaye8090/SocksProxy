#pragma once

#include <string>
using namespace std;

class CDataPack;

/******************************************************************************
数据解析类
功能：
	实现数据的解析操作
作者：
	佳也 2623168833 jaye8090@qq.com
时间：
	2013-6-9 到 2013-12-18
******************************************************************************/
class CDataParse
{
public:
	CDataParse(void);

	~CDataParse(void);

//基本接口
public:
	/**************************************************************************
	设置数据
	参数：
		pData			数据指针
						对象的生命周期内，需要此内存一直有效。

		uiDataSize		数据大小
	**************************************************************************/
	void SetData(void * pData, unsigned int uiDataSize);

	/**************************************************************************
	回退数据
	**************************************************************************/
	void BackData(void);

	/**************************************************************************
	弹出数据
	参数：
		pData			输出值。数据指针。
		uiDataSize		数据大小
	**************************************************************************/
	void Pop(unsigned char * & pData, unsigned int uiDataSize);

	/**************************************************************************
	弹出数据
	参数：
		ucData		输出值。数据。
	**************************************************************************/
	void Pop(unsigned char & ucData);

	/**************************************************************************
	弹出数据
	参数：
		usData		输出值。数据。
	**************************************************************************/
	void Pop(unsigned short & usData);

	/**************************************************************************
	弹出数据
	参数：
		uiData		输出值。数据。
	**************************************************************************/
	void Pop(unsigned int & uiData);

	/**************************************************************************
	弹出数据
	参数：
		ulData		输出值。数据。
	**************************************************************************/
	void Pop(unsigned long & ulData);

	/**************************************************************************
	弹出数据
	参数：
		strData		输出值。数据。
	**************************************************************************/
	void Pop(string & strData);

	/**************************************************************************
	先反向弹出2字节的数据大小，再根据数据大小弹出数据
	参数：
		pData			输出值。数据指针。
		uiDataSize		输出值。数据大小。
	**************************************************************************/
	void PopWithSize(unsigned char * & pData, unsigned int & uiDataSize);

	/**************************************************************************
	先反向弹出2字节的数据大小，再根据数据大小弹出数据
	参数：
		parse		输出值。数据解析。
	**************************************************************************/
	void PopWithSize(CDataParse & parse);

	/**************************************************************************
	先反向弹出2字节的数据大小，再根据数据大小弹出数据
	参数：
		data		输出值。数据。
	**************************************************************************/
	void PopWithSize(CDataPack & data);

	/**************************************************************************
	反向弹出数据
	参数：
		usData		输出值。数据。
	**************************************************************************/
	void PopReverse(unsigned short & usData);

	/**************************************************************************
	反向弹出数据
	参数：
		uiData		输出值。数据。
	**************************************************************************/
	void PopReverse(unsigned int & uiData);

	/**************************************************************************
	跳过数据
	参数：
		uiSkipSize		跳过大小
	**************************************************************************/
	void Skip(unsigned int uiSkipSize);

	/**************************************************************************
	先反向弹出2字节的数据大小，再根据数据大小跳过数据
	**************************************************************************/
	void SkipWithSize(void);

	/**************************************************************************
	解析是否成功
	返回：
		成功返回true，失败返回false。
	**************************************************************************/
	bool IsSucc(void);

	/**************************************************************************
	解析是否完成
	返回：
		完成返回true，否则返回false。
	**************************************************************************/
	bool IsDone(void);

//内部数据
private:
	unsigned char		* m_pData;			//数据指针
	unsigned int		m_uiDataSize;		//数据大小
	unsigned int		m_uiReadSize;		//已读数据大小

	bool		m_bParseSucc;		//解释是否成功
};